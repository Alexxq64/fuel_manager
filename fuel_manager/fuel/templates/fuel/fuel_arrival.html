{% extends 'fuel/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2>Приход топлива</h2>
  <form method="post">
    {% csrf_token %}

    <div class="mb-3">
      {{ form.fuel_type.label_tag }}
      {{ form.fuel_type }}
    </div>

    <div class="mb-3">
      {{ form.tank.label_tag }}
      <select name="tank" id="id_tank" class="form-select">
        <option value="">Сначала выберите тип топлива</option>
        {% for tank in form.fields.tank.queryset %}
          <option value="{{ tank.id }}" data-fuel="{{ tank.fuel_type.id }}">{{ tank.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      {{ form.liters.label_tag }}
      {{ form.liters }}
    </div>

    <div class="mb-3">
      {{ form.price_per_liter.label_tag }}
      {{ form.price_per_liter }}
    </div>

    <button type="submit" class="btn btn-success">Сохранить</button>
  </form>
</div>

<script>
  const fuelTypeSelect = document.getElementById('id_fuel_type');
  const tankSelect = document.getElementById('id_tank');

  function filterTanks() {
    const selectedFuel = fuelTypeSelect.value;

    [...tankSelect.options].forEach(option => {
      if (!option.value) return;

      const fuelId = option.getAttribute('data-fuel');
      option.style.display = (fuelId === selectedFuel) ? 'block' : 'none';
    });

    tankSelect.value = ''; // Сбросить выбор
  }

  fuelTypeSelect.addEventListener('change', filterTanks);
  document.addEventListener('DOMContentLoaded', filterTanks);
</script>
{% endblock %}
